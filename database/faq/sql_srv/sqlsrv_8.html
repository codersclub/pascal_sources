<HTML>
<head>
<TITLE>Простейшая хранимая процедура - FAQ по Базам Данных - Исходники.Ру</TITLE>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<LINK href="../sources.css" rel=stylesheet>
</head>
<body>
<table border="0" width="80%" align="center">
  <tr>
    <td valign="top">
      <h2>FAQ по Базам Данных<br>
      <font size="2">(<a class="blueb" href="http://pascal.sources.ru/cgi-bin/forum/YaBB.cgi" target="_blank">Форум
      на Исходниках.Ru</a>)</font></h2>
      <hr>
    </td>
  </tr>
  <tr>
    <td>
      <h3>Простейшая хранимая процедура</h3>
    </td>
  </tr>
  <tr>
    <td>
    Для начала неплохо бы понять, для
    чего вообще нужны хранимые процедуры.
    Допустим, если сервер БД, в котором
    хранятся данные, используемые в формулах
    на клиенте. Оператору, который работает
    на клиенте, сами эти данные не нужны, ему
    нужен готовый результат из формулы. То
    есть что же это получается? - Клиент
    получает данные из БД и у себя их
    обрабатывает? А если клиентов много,
    формул в них еще больше, а данных в базе -
    вообще море, то сервер и сеть испытывают
    серьездные перегрузки. Вот поэтому и были
    созданы хранимые процедуры,&nbsp; позволяющие обрабатывать данные еще на
    сервере, а клиенту передавать готовый
    результат. Кроме того, так как часть кода
    программы сосредотачивается на сервере в
    виде хранимых процедур, не нужно будет
    править клиентов при каждом обновлении.
<br>
<br>
    А теперь - ближе к делу:&nbsp;запускаем Enterprise
    Manager, выбираем нашу БД, а в ней, в разделе
    Stored Procedures -New Stored Procedure...
<dir>
    <img border="0" src="stored.gif" width="254" height="82">
</dir>
    Сервер сгенерирует &quot;болванку&quot;
    примерно такого содержания:
<pre><font color="#008000">CREATE PROCEDURE [OWNER].[PROCEDURE NAME] AS
</font></pre>
    Здесь нужно указать владельца процедуры
    вместо <font color="#008000">OWNER</font> (достаточно
    указать dbo),
    имя процедуры (вместо <font color="#008000">PROCEDURE NAME</font>).
    Вот что написал я:
<pre><font color="#008000">CREATE PROCEDURE [dbo].[MY_PROC] AS
    SELECT * FROM Table1
</font></pre>
    Если теперь выполнить запрос
<pre><font color="#008000">EXEC MY_PROC
</font></pre>
    то выполнится наша процедура, и
    соответственно будут выведены
    результаты SELECT'а.
<br>
    А можно ли передавать параметры в процедуру?
<br>
    Можно! Вот так:
<pre><font color="#008000">CREATE PROCEDURE [dbo].[MY_PROC]
    @name char(50)
    AS
    exec('SELECT * FROM '+@name+'')
</font></pre>
    Что произойдет при вызове
    <font color="#008000">EXEC MY_PROC 'Table1'</font>
    я думаю понятно всем :) - выполнится
    выборка из Table1. Но ведь можно указать и
    другую таблицу? ;)
<br>
<br>
    Если нужно передать несколько параметров,
    укажите их через запятую -
<br>
<font color="#008000">@name char(50), @id int</font>
<br>
<br>
<br>
      <a class="blueb" href="../index.html">Содержание</a>
    </td>
  </tr>
</table>
</body>
</HTML>
